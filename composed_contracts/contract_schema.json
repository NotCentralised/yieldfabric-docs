{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "YieldFabric Contract DSL Schema",
  "type": "object",
  "required": ["contract"],
  "properties": {
    "contract": {
      "type": "object",
      "required": ["metadata", "parties", "obligations", "composed_contract"],
      "properties": {
        "metadata": {
          "type": "object",
          "required": ["name", "description", "type", "version"],
          "properties": {
            "name": {
              "type": "string",
              "minLength": 1
            },
            "description": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": ["bond", "loan", "mortgage", "structured_product", "annuity", "swap"]
            },
            "version": {
              "type": "string",
              "pattern": "^\\d+\\.\\d+(\\.\\d+)?$"
            },
            "effective_date": {
              "type": "string",
              "format": "date-time"
            },
            "expiry_date": {
              "type": "string",
              "format": "date-time"
            },
            "legal_document_id": {
              "type": "string"
            }
          }
        },
        "parties": {
          "type": "object",
          "required": ["issuer", "counterpart"],
          "properties": {
            "issuer": {
              "$ref": "#/definitions/party"
            },
            "counterpart": {
              "$ref": "#/definitions/party"
            },
            "obligor": {
              "$ref": "#/definitions/party"
            }
          }
        },
        "obligations": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/obligation"
          }
        },
        "composed_contract": {
          "type": "object",
          "required": ["name", "description"],
          "properties": {
            "name": {
              "type": "string",
              "minLength": 1
            },
            "description": {
              "type": "string"
            }
          }
        },
        "loan_terms": {
          "$ref": "#/definitions/loan_terms"
        },
        "mortgage_terms": {
          "$ref": "#/definitions/mortgage_terms"
        },
        "structured_product_terms": {
          "$ref": "#/definitions/structured_product_terms"
        }
      }
    }
  },
  "definitions": {
    "party": {
      "type": "object",
      "required": ["entity_id"],
      "properties": {
        "entity_id": {
          "type": "string"
        },
        "wallet_id": {
          "type": ["string", "null"]
        },
        "role": {
          "type": "string",
          "enum": ["issuer", "counterpart", "obligor", "lender", "borrower"]
        }
      }
    },
    "obligation": {
      "type": "object",
      "required": ["name", "description", "denomination", "expiry"],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "coupon_stream",
            "redemption",
            "principal_stream",
            "interest_stream",
            "p_and_i_stream",
            "escrow_stream",
            "capital_protection",
            "equity_participation",
            "annuity_stream",
            "custom"
          ]
        },
        "denomination": {
          "type": "string"
        },
        "notional": {
          "type": "string",
          "pattern": "^\\d+$"
        },
        "expiry": {
          "type": "string",
          "format": "date-time"
        },
        "counterpart": {
          "type": "string"
        },
        "counterpart_wallet_id": {
          "type": "string"
        },
        "obligor": {
          "type": "string"
        },
        "obligor_wallet_id": {
          "type": "string"
        },
        "obligation_address": {
          "type": "string"
        },
        "payment_schedule": {
          "$ref": "#/definitions/payment_schedule"
        }
      }
    },
    "payment_schedule": {
      "type": "object",
      "required": ["payments"],
      "properties": {
        "amount": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^\\d+$"
            },
            {
              "type": "string",
              "enum": ["variable"]
            }
          ]
        },
        "frequency": {
          "type": "string",
          "enum": ["daily", "weekly", "biweekly", "monthly", "quarterly", "semiannually", "annually"]
        },
        "start_date": {
          "type": "string",
          "format": "date-time"
        },
        "end_date": {
          "type": "string",
          "format": "date-time"
        },
        "payments": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/payment"
          }
        }
      }
    },
    "payment": {
      "type": "object",
      "required": ["date", "unlock_sender", "unlock_receiver"],
      "properties": {
        "date": {
          "type": "string",
          "format": "date-time"
        },
        "unlock_sender": {
          "type": "string",
          "format": "date-time"
        },
        "unlock_receiver": {
          "type": "string",
          "format": "date-time"
        },
        "oracle_conditions": {
          "$ref": "#/definitions/oracle_conditions"
        },
        "linear_vesting": {
          "type": "boolean"
        },
        "vesting_start": {
          "type": "string",
          "format": "date-time"
        },
        "vesting_end": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "oracle_conditions": {
      "type": "object",
      "properties": {
        "oracle_address": {
          "type": "string"
        },
        "oracle_owner": {
          "type": "string"
        },
        "oracle_key_sender": {
          "type": "string"
        },
        "oracle_value_sender": {
          "type": "string"
        },
        "oracle_value_sender_secret": {
          "type": "string"
        },
        "oracle_key_recipient": {
          "type": "string"
        },
        "oracle_value_recipient": {
          "type": "string"
        },
        "oracle_value_recipient_secret": {
          "type": "string"
        },
        "barrier_check": {
          "type": "boolean"
        },
        "barrier_level": {
          "type": "number"
        },
        "participation_rate": {
          "type": "number"
        }
      }
    },
    "loan_terms": {
      "type": "object",
      "required": ["principal", "interest_rate", "term_months", "payment_frequency", "denomination"],
      "properties": {
        "principal": {
          "type": "string",
          "pattern": "^\\d+$"
        },
        "interest_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "term_months": {
          "type": "integer",
          "minimum": 1
        },
        "payment_frequency": {
          "type": "string",
          "enum": ["daily", "weekly", "biweekly", "monthly", "quarterly"]
        },
        "denomination": {
          "type": "string"
        }
      }
    },
    "mortgage_terms": {
      "type": "object",
      "required": ["principal", "interest_rate", "term_years", "payment_frequency", "denomination"],
      "properties": {
        "principal": {
          "type": "string",
          "pattern": "^\\d+$"
        },
        "interest_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "term_years": {
          "type": "integer",
          "minimum": 1,
          "maximum": 50
        },
        "payment_frequency": {
          "type": "string",
          "enum": ["monthly", "biweekly"]
        },
        "denomination": {
          "type": "string"
        },
        "property_address": {
          "type": "string"
        },
        "property_value": {
          "type": "string",
          "pattern": "^\\d+$"
        },
        "ltv_ratio": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "structured_product_terms": {
      "type": "object",
      "required": ["principal", "denomination"],
      "properties": {
        "principal": {
          "type": "string",
          "pattern": "^\\d+$"
        },
        "denomination": {
          "type": "string"
        },
        "capital_protection": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "participation_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "underlying_asset": {
          "type": "string"
        },
        "barrier_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    }
  }
}











