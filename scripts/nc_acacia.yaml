commands:

  # CREATE INVOICE
  - name: originator_CREATE_invoice_1
    type: create_obligation
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      idempotency_key: create_invoice_1-ergonomic-$(date +%s)
      counterpart: payer@yieldfabric.com
      denomination: aud-token-asset
      obligor: payer@yieldfabric.com
      expiry: 2025-11-30
      data: 
        name: "Invoice 1"
        description: "Invoice 1 Description"
      initial_payments:
        amount: 100
        payments:
          - id: payment-1
            payee:
              unlock: 2025-12-31
  
  - name: payer_accept_obligation_obligor_1
    type: accept_obligation
    user: 
      id: payer@yieldfabric.com
      password: payer_password
    parameters:
      idempotency_key: accept_obligation-ergonomic-$(date +%s)
      contract_id: $originator_CREATE_invoice_1.contract_id


  # ISSUANCE
  - name: issuer_group_CREATE_investment_token
    type: create_obligation
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: create_investment_token-ergonomic-$(date +%s)
      counterpart: Issuer Group
      expiry: 2025-11-30
      data: 
        name: "Structured Product"
        description: "Structured Product Description"

  - name: issuer_group_CREATE_credit_token
    type: create_obligation
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: create_credit_token-ergonomic-$(date +%s)
      counterpart: Issuer Group
      expiry: 2025-11-30
      data: 
        name: "Credit Facility"
        description: "Credit Facility Description"

  - name: collateral_group_CREATE_collateral_token
    type: create_obligation
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      idempotency_key: create_collateral_token-ergonomic-$(date +%s)
      counterpart: Collateral Group
      expiry: 2025-11-30
      data: 
        name: "Collateral Token"
        description: "Collateral Token Description"


  # ADD ACCOUNT MEMBER (NFT-based membership using obligation contracts)
  - name: add_issuer_group_member-1
    type: add_account_member
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $issuer_group_CREATE_credit_token.contract_id  # Contract ID (will extract numeric part) or use id_hash if available

  - name: add_issuer_group_member-2
    type: add_account_member
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $issuer_group_CREATE_investment_token.contract_id

  - name: add_collateralgroup_member-1
    type: add_account_member
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $collateral_group_CREATE_collateral_token.contract_id


  # INVESTOR FUNDING
  - name: investor_deposit
    type: deposit
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      asset_id: aud-token-asset
      amount: 1000
      idempotency_key: deposit-$(date +%s)

  - name: create_investment_swap-1
    type: create_swap
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      swap_id: "123456789"
      idempotency_key: swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $issuer_group_CREATE_investment_token.contract_id

      counterparty:
        id: investor@yieldfabric.com
        expected_payments:
          denomination: aud-token-asset
          amount: 1000
          payments:
            - id: swap-payment-1
      deadline: 2025-12-31

  - name: complete_investment_swap-1
    type: complete_swap
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      swap_id: "123456789"
      idempotency_key: complete-investment-swap-ergonomic-$(date +%s)

  - name: issuer_accept_1
    type: accept_all
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: accept-$(date +%s)
      denomination: aud-token-asset
  

  # COLLATERAL BINDING
  - name: create_credit_swap-1
    type: create_swap
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      swap_id: "1234567891"
      idempotency_key: create-credit-swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $issuer_group_CREATE_credit_token.contract_id

      counterparty:
        id: Collateral Group
        obligation_ids:
          - $collateral_group_CREATE_collateral_token.contract_id
      deadline: 2025-12-31

  - name: complete_credit_swap-1
    type: complete_swap
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      swap_id: "1234567891"
      idempotency_key: complete-credit-swap-ergonomic-$(date +%s)
      

  # CAPITAL DEPLOYMENT
  # NOTE: Factor invoice at 90% of the notional amount
  - name: create_capital_swap-1
    type: create_swap
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      swap_id: "12345678912"
      idempotency_key: swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $originator_CREATE_invoice_1.contract_id

      counterparty:
        id: Issuer Group
        expected_payments:
          denomination: aud-token-asset
          amount: 90
          payments:
            - id: swap-payment-1
      deadline: 2025-12-31


  # COMPOSED OPERATION: Complete Swap + Transfer Obligation Atomically
  - name: complete_capital_swap-1
    type: composed_operation
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Issuer Group
    parameters:
      idempotency_key: complete-capital-swap-ergonomic-$(date +%s)
      operations:
        # Operation 1: Complete the capital swap
        - operation_type: complete_swap
          operation_data:
            swap_id: "12345678912"
        # Operation 2: Transfer the obligation received from swap
        - operation_type: transfer_obligation
          operation_data:
            contract_id: $originator_CREATE_invoice_1.contract_id
            destination_id: Collateral Group

  - name: originator_accept_1
    type: accept_all
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      idempotency_key: accept-$(date +%s)
      denomination: aud-token-asset


  # INVESTOR CAPITAL CALL
  - name: investor_send_1
    type: instant
    user: 
      id: investor@yieldfabric.com
      password: investor_password
      group: Issuer Group
    parameters:
      asset_id: aud-token-asset
      amount: 100
      idempotency_key: instant-$(date +%s)
      destination_id: investor@yieldfabric.com

  - name: investor_accept_1
    type: accept
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      idempotency_key: accept-$(date +%s)
      payment_id: $investor_send_1.payment_id