commands:

  # Group Accounts:
  #
  # - issuer: issuer account holds cash like assets and collateral assets.
  # - collateral: collateral account holds credit token and invoices

  # Tokens:
  # 
  # - invoice_token: payer obligation to pay 100 units of aud-token-asset to owner of the NFT
  # - credit_token: issuer account grants a credit line to owner of the NFT. The credit line is offered by allowing the owner to transfer funds from the issuer account.
  # - investment_token: issuer account grants the benefitial rights of all it's assets to the owner of the NFT. All distributions are made from the issuer account to the owner of the NFT.
  # - collateral_token: collateral account grants the benefitial rights of all it's assets to the owner of the NFT. All distributions are made from the collateral account to the owner of the NFT.

  # Flow:
  #
  # 1. Create Invoice:
  #    a. create_obligation: Creates an invoice token with a payment obligation to pay 100 units of aud-token-asset to owner of the NFT.
  #    b. accept_obligation: Accepts the invoice token.
  # 2. Issuance:
  #    a. create_obligation (investment_token): Issues an NFT granting beneficial rights to all issuer account assets and distributions.
  #    b. create_obligation (credit_token): Issues an NFT that provides a credit line, allowing transfers from the issuer account.
  #    c. create_obligation (collateral_token): Issues an NFT granting beneficial rights to the collateral account's assets and distributions.
  # 3. Add Account Member:
  #    a. add_account_member (credit_token): Grants issuer group membership tied to the credit facility obligation.
  #    b. add_account_member (investment_token): Grants issuer group membership tied to the investment rights obligation.
  #    c. add_account_member (collateral_token): Grants collateral group membership tied to the collateral rights obligation.
  # 4. Investor Funding:
  #    a. deposit: Investor funds their account with aud-token-asset.
  #    b. create_swap: Issuer proposes an investment swap offering the investment token.
  #    c. complete_swap: Investor accepts and executes the investment swap.
  #    d. accept_all: Issuer clears the resulting aud-token-asset distributions.
  # 5. Collateral Binding:
  #    a. create_swap: Issuer proposes a collateral swap exchanging credit and collateral tokens.
  #    b. complete_swap: Collateral group accepts and binds the collateral obligations.
  # 6. Capital Deployment:
  #    a. create_swap: Originator proposes factoring the invoice for 90% of its value.
  #    b. composed_operation: Completes the capital swap and transfers the invoice obligation to the collateral group.
  #    c. accept_all: Originator accepts the received aud-token-asset distributions.
  # 7. Investor Capital Call:
  #    a. instant: Investor sends additional capital to their own account under issuer group context.
  #    b. accept: Investor confirms receipt of the capital call payment.


  # CREATE INVOICE
  - name: invoice_token
    type: create_obligation
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      idempotency_key: create_invoice_1-ergonomic-$(date +%s)
      counterpart: payer@yieldfabric.com
      denomination: aud-token-asset
      obligor: payer@yieldfabric.com
      expiry: 2025-11-30
      data: 
        name: "Invoice 1"
        description: "Invoice 1 Description"
      initial_payments:
        amount: 100
        payments:
          - id: payment-1
            payee:
              unlock: 2025-12-31
  
  - name: payer_accept_invoice_token
    type: accept_obligation
    user: 
      id: payer@yieldfabric.com
      password: payer_password
    parameters:
      idempotency_key: accept_obligation-ergonomic-$(date +%s)
      contract_id: $invoice_token.contract_id


  # ISSUANCE
  - name: investment_token
    type: create_obligation
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: create_investment_token-ergonomic-$(date +%s)
      counterpart: Issuer Group
      expiry: 2025-11-30
      data: 
        name: "Structured Product"
        description: "Structured Product Description"

  - name: credit_token
    type: create_obligation
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: create_credit_token-ergonomic-$(date +%s)
      counterpart: Issuer Group
      expiry: 2025-11-30
      data: 
        name: "Credit Facility"
        description: "Credit Facility Description"

  - name: collateral_token
    type: create_obligation
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      idempotency_key: create_collateral_token-ergonomic-$(date +%s)
      counterpart: Collateral Group
      expiry: 2025-11-30
      data: 
        name: "Collateral Token"
        description: "Collateral Token Description"


  # ADD ACCOUNT MEMBER (NFT-based membership using obligation contracts)
  - name: add_issuer_group_member_1
    type: add_account_member
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $credit_token.contract_id  # Contract ID (will extract numeric part) or use id_hash if available

  - name: add_issuer_group_member_2
    type: add_account_member
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $investment_token.contract_id

  - name: add_collateralgroup_member_1
    type: add_account_member
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      idempotency_key: add-issuer-group-member-ergonomic-$(date +%s)
      obligation_id: $collateral_token.contract_id


  # INVESTOR FUNDING
  - name: investor_deposit
    type: deposit
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      asset_id: aud-token-asset
      amount: 1000
      idempotency_key: deposit-$(date +%s)

  - name: create_investment_swap_1
    type: create_swap
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      swap_id: "123456789"
      idempotency_key: swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $investment_token.contract_id

      counterparty:
        id: investor@yieldfabric.com
        expected_payments:
          denomination: aud-token-asset
          amount: 1000
          payments:
            - id: swap-payment-1
      deadline: 2025-12-31

  - name: complete_investment_swap_1
    type: complete_swap
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      swap_id: "123456789"
      idempotency_key: complete-investment-swap-ergonomic-$(date +%s)

  - name: issuer_accept_1
    type: accept_all
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      idempotency_key: accept-$(date +%s)
      denomination: aud-token-asset
  

  # COLLATERAL BINDING
  - name: create_credit_swap_1
    type: create_swap
    user: 
      id: issuer@yieldfabric.com
      password: issuer_password
      group: Issuer Group
    parameters:
      swap_id: "1234567891"
      idempotency_key: create-credit-swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $credit_token.contract_id

      counterparty:
        id: Collateral Group
        obligation_ids:
          - $collateral_token.contract_id
      deadline: 2025-12-31

  - name: complete_credit_swap_1
    type: complete_swap
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Collateral Group
    parameters:
      swap_id: "1234567891"
      idempotency_key: complete-credit-swap-ergonomic-$(date +%s)
      

  # CAPITAL DEPLOYMENT
  # NOTE: Factor invoice at 90% of the notional amount
  - name: create_capital_swap_1
    type: create_swap
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      swap_id: "12345678912"
      idempotency_key: swap-ergonomic-$(date +%s)
      initiator:
        obligation_ids:
          - $invoice_token.contract_id

      counterparty:
        id: Issuer Group
        expected_payments:
          denomination: aud-token-asset
          amount: 90
          payments:
            - id: swap-payment-1
      deadline: 2025-12-31

  - name: complete_capital_swap_1
    type: composed_operation
    user: 
      id: collateral@yieldfabric.com
      password: collateral_password
      group: Issuer Group
    parameters:
      idempotency_key: complete-capital-swap-ergonomic-$(date +%s)
      operations:
        # Operation 1: Complete the capital swap
        - operation_type: complete_swap
          operation_data:
            swap_id: "12345678912"
        # Operation 2: Transfer the obligation received from swap
        - operation_type: transfer_obligation
          operation_data:
            contract_id: $invoice_token.contract_id
            destination_id: Collateral Group

  - name: originator_accept_1
    type: accept_all
    user: 
      id: originator@yieldfabric.com
      password: originator_password
    parameters:
      idempotency_key: accept-$(date +%s)
      denomination: aud-token-asset


  # INVESTOR CAPITAL CALL
  - name: investor_send_1
    type: instant
    user: 
      id: investor@yieldfabric.com
      password: investor_password
      group: Issuer Group
    parameters:
      asset_id: aud-token-asset
      amount: 100
      idempotency_key: instant-$(date +%s)
      destination_id: investor@yieldfabric.com

  - name: investor_accept_1
    type: accept
    user: 
      id: investor@yieldfabric.com
      password: investor_password
    parameters:
      idempotency_key: accept-$(date +%s)
      payment_id: $investor_send_1.payment_id